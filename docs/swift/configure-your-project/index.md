Configure Your Project Once you have integrated the Dropbox Swift SDK into your project, there are a few additional steps to take before you can begin making API calls. ## Application \`.plist\` file If you are compiling on iOS SDK 9.0, you will need to modify your application's \`.plist\` to handle Apple's \[new security changes\](https://developer.apple.com/videos/wwdc/2015/?id=703) to the \`canOpenURL\` function. You should add the following code to your application's \`.plist\` file: \`\`\`xml <key>LSApplicationQueriesSchemes</key> <array> <string>dbapi-8-emm</string> <string>dbapi-2</string> </array> \`\`\` This allows the Swift SDK to determine if the official Dropbox iOS app is installed on the current device. If it is installed, then the official Dropbox iOS app can be used to programmatically obtain an OAuth 2.0 access token. Additionally, your application needs to register to handle a unique Dropbox URL scheme for redirect following completion of the OAuth 2.0 authorization flow. This URL scheme should have the format \`db-<APP\_KEY>\`, where \`<APP\_KEY>\` is your Dropbox app's app key, which can be found in the \[App Console\](https://dropbox.com/developers/apps). You should add the following code to your \`.plist\` file (but be sure to replace \`<APP\_KEY>\` with your app's app key): \`\`\`xml <key>CFBundleURLTypes</key> <array> <dict> <key>CFBundleURLSchemes</key> <array> <string>db-<APP\_KEY></string> </array> <key>CFBundleURLName</key> <string></string> </dict> </array> \`\`\` ## Handling the authorization flow There are three methods to programmatically retrieve an OAuth 2.0 access token: - \*\*Direct auth\*\* (iOS only): This launches the official Dropbox iOS app (if installed), authenticates via the official app, then redirects back into the SDK. - \*\*Safari view controller auth\*\* (iOS only): This launches a \`SFSafariViewController\` to facilitate the auth flow. This is desirable because it is safer for the end-user, and pre-existing session data can be used to avoid requiring the user to re-enter their Dropbox credentials. - \*\*Redirect to external browser\*\* (macOS only): This launches the user's default browser to facilitate the auth flow. This is also desirable because it is safer for the end-user, and pre-existing session data can be used to avoid requiring the user to re-enter their Dropbox credentials. To facilitate the above authorization flows, you should take the following steps: ### Initialize a \`DropboxClient\` instance From your application delegate: > \*\*SwiftUI note:\*\* You may need to create an Application Delegate if your application doesn't have one. \*\*iOS\*\* \`\`\`swift import SwiftyDropbox func application(\_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: \[UIApplication.LaunchOptionsKey: Any\]?) -> Bool { DropboxClientsManager.setupWithAppKey("<APP\_KEY>") return true } \`\`\` \*\*macOS\*\* \`\`\`swift import SwiftyDropbox func applicationDidFinishLaunching(\_ aNotification: Notification) { DropboxClientsManager.setupWithAppKeyDesktop("<APP\_KEY>") } \`\`\` ### Begin the authorization flow You can commence the auth flow by calling \`authorizeFromControllerV2:controller:openURL\` method in your application's view controller. Note that the controller reference will be weakly held. For SwiftUI applications \`nil\` can be passed in for the controller argument and the app's root view controller will be used to present the flow. From your view controller: \*\*iOS\*\* \`\`\`swift import SwiftyDropbox func myButtonInControllerPressed() { // OAuth 2 code flow with PKCE that grants a short-lived token with scopes, // and performs refreshes of the token automatically. let scopeRequest = ScopeRequest(scopeType: .user, scopes: \["account\_info.read"\], includeGrantedScopes: false) DropboxClientsManager.authorizeFromControllerV2( UIApplication.shared, controller: self, loadingStatusDelegate: nil, openURL: { (url: URL) -> Void in UIApplication.shared.open(url, options: \[:\], completionHandler: nil) }, scopeRequest: scopeRequest ) } \`\`\` \*\*macOS\*\* \`\`\`swift import SwiftyDropbox func myButtonInControllerPressed() { // OAuth 2 code flow with PKCE that grants a short-lived token with scopes, // and performs refreshes of the token automatically. let scopeRequest = ScopeRequest(scopeType: .user, scopes: \["account\_info.read"\], includeGrantedScopes: false) DropboxClientsManager.authorizeFromControllerV2( sharedApplication: NSApplication.shared, controller: self, loadingStatusDelegate: nil, openURL: {(url: URL) -> Void in NSWorkspace.shared.open(url)}, scopeRequest: scopeRequest ) } \`\`\` ### Handle redirect back into SDK To handle the redirection back into the Swift SDK once the authentication flow is complete, you should add the following code in your application's delegate: > \*\*SwiftUI note:\*\* You may need to create an Application Delegate if your application doesn't have one. \*\*iOS\*\* \`\`\`swift import SwiftyDropbox func application(\_ app: UIApplication, open url: URL, options: \[UIApplication.OpenURLOptionsKey : Any\] = \[:\]) -> Bool { let oauthCompletion: DropboxOAuthCompletion = { if let authResult = $0 { switch authResult { case .success: print("Success! User is logged into DropboxClientsManager.") case .cancel: print("Authorization flow was manually canceled by user!") case .error(\_, let description): print("Error: \\(String(describing: description))") } } } let canHandleUrl = DropboxClientsManager.handleRedirectURL(url, includeBackgroundClient: false, completion: oauthCompletion) return canHandleUrl } \`\`\` Or if your app is iOS13+, or your app also supports Scenes, add the following code into your application's main scene delegate: > \*\*Note:\*\* You may need to create a Scene Delegate if your application doesn't have one. \`\`\`swift import SwiftyDropbox func scene(\_ scene: UIScene, openURLContexts URLContexts: Set<UIOpenURLContext>) { let oauthCompletion: DropboxOAuthCompletion = { if let authResult = $0 { switch authResult { case .success: print("Success! User is logged into DropboxClientsManager.") case .cancel: print("Authorization flow was manually canceled by user!") case .error(\_, let description): print("Error: \\(String(describing: description))") } } } for context in URLContexts { // stop iterating after the first handle-able url if DropboxClientsManager.handleRedirectURL(context.url, includeBackgroundClient: false, completion: oauthCompletion) { break } } } \`\`\` \*\*macOS\*\* \`\`\`swift import SwiftyDropbox func applicationDidFinishLaunching(\_ aNotification: Notification) { ...... // code outlined above goes here NSAppleEventManager.shared().setEventHandler(self, andSelector: #selector(handleGetURLEvent), forEventClass: AEEventClass(kInternetEventClass), andEventID: AEEventID(kAEGetURL)) } func handleGetURLEvent(\_ event: NSAppleEventDescriptor?, replyEvent: NSAppleEventDescriptor?) { if let aeEventDescriptor = event?.paramDescriptor(forKeyword: AEKeyword(keyDirectObject)) { if let urlStr = aeEventDescriptor.stringValue { let url = URL(string: urlStr)! let oauthCompletion: DropboxOAuthCompletion = { if let authResult = $0 { switch authResult { case .success: print("Success! User is logged into Dropbox.") case .cancel: print("Authorization flow was manually canceled by user!") case .error(\_, let description): print("Error: \\(String(describing: description))") } } } DropboxClientsManager.handleRedirectURL(url, includeBackgroundClient: false, completion: oauthCompletion) // this brings your application back the foreground on redirect NSApp.activate(ignoringOtherApps: true) } } } \`\`\` If they press \*\*Allow\*\* or \*\*Cancel\*\*, the \`db-<APP\_KEY>\` redirect URL will be launched from the webview, and will be handled in your application delegate's \`application:handleOpenURL\` method, from which the result of the authorization can be parsed. Now you're ready to begin making API requests!